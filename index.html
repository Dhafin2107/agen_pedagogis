<!DOCTYPE html>
<html>
<head>
  <title>Simulasi Agen Pedagogis</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.738.0.min.js"></script>
  <style>
    .popup {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 9999;
    }
    
    .popup-content {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    
    .popup-content img {
      width: 200px;
      height: 200px;
      margin-bottom: 20px;
    }
	
	#canvas {
			display: none;
		}
      body {
        margin: 0;
        padding: 0;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        align-items: stretch;
        height: 100vh;
      }
      .main-video {
        width: 70%;
        height: 100%;
      }
      .side-videos-wrapper {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 30%;
        height: 100%;
      }
      .side-video {
        width: 100%;
        height: calc(33.333% - 10px); /* 10px margin-top between videos */
      }
      @media screen and (max-width: 768px) {
        .container {
          flex-direction: column;
        }
        .main-video, .side-videos-wrapper {
          width: 100%;
        }
        .main-video {
          height: 50vh;
        }
        .side-video {
          height: calc(50% - 5px); /* 5px margin-top between videos */
        }
      }
	  #agenVideo {
			background-image: url('load.gif');
			background-size: cover;
			animation: pulse 3s infinite;
			}
  </style>
  
  
</head>
<body>

  <div class="popup" id="popup">
    <div class="popup-content">
      <h2>Pilih Agen</h2>
      <img src="L1.png" onmouseover="changeImage(this, 'L2.png')" onmouseout="changeImage(this, 'L1.png')" onclick="selectCharacter('L')" alt="Karakter Laki-Laki">
      <img src="P1.png" onmouseover="changeImage(this, 'P2.png')" onmouseout="changeImage(this, 'P1.png')" onclick="selectCharacter('P')" alt="Karakter Perempuan">
    </div>
  </div>
  
  <div class="container">
      <div class="main-video">
        <iframe width="100%" height="100%"  frameborder="0" src="learn.webm" allow="autoplay; encrypted-media"></iframe>
      </div>
      <div class="side-videos-wrapper">
        <div class="side-video">
          <iframe id="agenVideo" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media"></iframe>
        </div>
        <div class="side-video">
          <video id="video" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media"></video>
        </div>
      </div>
    </div>
	<canvas id="canvas" width="640" height="480"></canvas>
	
  <script>
  
	var selectedCharacter = '';
    function changeImage(element, newImage) {
      element.src = newImage;
    }
    
    function selectCharacter(character) {
      var popup = document.getElementById('popup');
      popup.style.display = 'none';
      
      selectedCharacter = character;
	  
	  var folder = selectedCharacter + "/"; //mengarahkan de direktori yang dipilih

	  var images = [
		  "Neutral.gif",
		  "Happy.gif",
		  "Sadness.gif",
		  "Anger.gif",
		  "Surprised.gif",
		  "Confused.gif",
		  "Neutral2Happy.gif",
		  "Neutral2Sadness.gif",
		  "Neutral2Anger.gif",
		  "Neutral2Surprised.gif",
		  "Neutral2Confused.gif",
		  "Happy2Neutral.gif",
		  "Happy2Sadness.gif",
		  "Happy2Anger.gif",
		  "Happy2Surprised.gif",
		  "Happy2Confused.gif",
		  "Sadness2Neutral.gif",
		  "Sadness2Happy.gif",
		  "Sadness2Anger.gif",
		  "Sadness2Surprised.gif",
		  "Sadness2Confused.gif",
		  "Anger2Neutral.gif",
		  "Anger2Happy.gif",
		  "Anger2Sadness.gif",
		  "Anger2Surprised.gif",
		  "Anger2Confused.gif",
		  "Surprised2Neutral.gif",
		  "Surprised2Happy.gif",
		  "Surprised2Sadness.gif",
		  "Surprised2Anger.gif",
		  "Surprised2Confused.gif",
		  "Confused2Neutral.gif",
		  "Confused2Happy.gif",
		  "Confused2Sadness.gif",
		  "Confused2Anger.gif",
		  "Confused2Surprised.gif"
		// Daftar gambar lainnya
	  ];

	  for (var i = 0; i < images.length; i++) {
		var imageSrc = folder + images[i];
		var link = document.createElement("link");
		link.rel = "preload";
		link.href = imageSrc;
		link.as = "image";
		link.type = "image/gif";
		document.head.appendChild(link);
	  }
	  
	  
	  // Membuat instance dari AWS Rekognition SDK dengan menggunakan access key dan secret key yang valid
      const rekognition = new AWS.Rekognition({
        region: 'ap-southeast-2',
        accessKeyId: 'AKIA5WGSLCIKGLDGFXPB',
        secretAccessKey: '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'
      });
	  
	  // Mengambil elemen video dan canvas dari dokumen HTML
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
	  const ctx = canvas.getContext("2d");

      // Mengatur konfigurasi media yang akan digunakan oleh getUserMedia
      const constraints = {
        video: true
      };

      // Mengambil akses dari webcam melalui getUserMedia
      navigator.mediaDevices.getUserMedia(constraints)
        .then(function(mediaStream) {
          video.srcObject = mediaStream;
          // Ketika metadata dari video sudah di-load, memutar video
          video.onloadedmetadata = function(e) {
            video.play();
          };
        })
        .catch(function(err) { console.log(err.name + ": " + err.message); });
		
		
	  // Inisialisasi variabel untuk menyimpan emosi sebelumnya
      let prevEmotion = 'CALM';
	  
	  // Membuat fungsi interval untuk capture gambar setiap 5 detik
      setInterval(function() {
        // Menggambar hasil capture video ke dalam elemen canvas
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        // Mengonversi gambar menjadi blob dan membacanya sebagai array buffer
        canvas.toBlob(function(blob) {
          const fileReader = new FileReader();
          fileReader.onload = function() {
            const arrayBuffer = this.result;
            const byteArray = new Uint8Array(arrayBuffer);
            // Mengirim gambar sebagai byte array ke AWS Rekognition untuk proses face detection
            rekognition.detectFaces({
              Image: {
                Bytes: byteArray
              },
              Attributes: ['ALL']
            }, function(err, data) {
              if (err) {
                console.log(err, err.stack);
              } else if (data.FaceDetails && data.FaceDetails.length > 0) {
                const emotions = data.FaceDetails[0].Emotions;
                const maxEmotion = emotions.reduce(function(prev, current) {
                  return (prev.Confidence > current.Confidence) ? prev : current
                });
                // Menampilkan jenis emosi terbesar pada konsol
                console.log(maxEmotion.Type);
				respondToEmotion(maxEmotion.Type);
              } else {
                console.log("No faces detected");
				playVideo(selectedCharacter + 'Confused.gif');
              }
            });
			
			const agenVideo = document.getElementById('agenVideo');
			const expressionBtns = document.querySelectorAll('.expressionBtn');

			function playVideo(videoName) {
				agenVideo.style.backgroundImage = `url(${videoName})`;
			}
			// Fungsi untuk memberikan respon terhadap ekspresi wajah yang dideteksi
			function respondToEmotion(emotion) {
			  // Menampilkan pesan respons terkait ekspresi wajah yang dideteksi
			  switch(emotion) {
				case 'HAPPY':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi HAPPY");
					playVideo(selectedCharacter + '/Neutral2Happy.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi HAPPY");
					playVideo(selectedCharacter + '/Sadness2Happy1.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi HAPPY");
					playVideo(selectedCharacter + '/Anger2Happy.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi HAPPY");
					playVideo(selectedCharacter + '/Confused2Happy.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi HAPPY");
					playVideo(selectedCharacter + '/Anger2Happy.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi HAPPY");
					playVideo(selectedCharacter + '/Surprised2Happy.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi HAPPY");
					playVideo(selectedCharacter + '/Sadness2Happy.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi HAPPY");
					playVideo(selectedCharacter + '/Confused2Happy.gif');
				  } else{
					console.log("masih HAPPY");
					playVideo(selectedCharacter + '/Happy.gif');
				  }
				  break;
				case 'SAD':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi SAD");
					playVideo(selectedCharacter + '/Neutral2sadness.gif');
				  } else if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi SAD");
					playVideo(selectedCharacter + '/Happy2Sadness.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi SAD");
					playVideo(selectedCharacter + '/Anger2Sadness.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi SAD");
					playVideo(selectedCharacter + '/Confused2Sadness.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi SAD");
					playVideo(selectedCharacter + '/Anger2Sadness.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi SAD");
					playVideo(selectedCharacter + '/Surprised2Sadness.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi SAD");
					playVideo(selectedCharacter + '/Sadness.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi SAD");
					playVideo(selectedCharacter + '/Confused2Sadness.gif');
				  } else{
					console.log("masih SAD");
					playVideo(selectedCharacter + '/Sadness.gif');
				  }
				  break;
				case 'ANGRY':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi ANGRY");
					playVideo(selectedCharacter + '/Neutral2Anger.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi ANGRY");
					playVideo(selectedCharacter + '/Sadness2Anger.gif');
				  } else if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi ANGRY");
					playVideo(selectedCharacter + '/Happy2Anger.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi ANGRY");
					playVideo(selectedCharacter + '/Confused2Anger.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi ANGRY");
					playVideo(selectedCharacter + '/Anger.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi ANGRY");
					playVideo(selectedCharacter + '/Surprised2Anger.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi ANGRY");
					playVideo(selectedCharacter + '/Sadness2Anger.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi ANGRY");
					playVideo(selectedCharacter + '/Confused2Anger.gif');
				  } else{
					console.log("masih ANGRY");
					playVideo(selectedCharacter + '/Anger.gif');
				  }
				  break;
				case 'CONFUSED':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi CONFUSED");
					playVideo(selectedCharacter + '/Neutral2Confused.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi CONFUSED");
					playVideo(selectedCharacter + '/Sadness2Confused.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi CONFUSED");
					playVideo(selectedCharacter + '/Anger2Confused.gif');
				  } else if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi CONFUSED");
					playVideo(selectedCharacter + '/Happy2Confused.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi CONFUSED");
					playVideo(selectedCharacter + '/Anger2Confused.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi CONFUSED");
					playVideo(selectedCharacter + '/Surprised2Confused.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi CONFUSED");
					playVideo(selectedCharacter + '/Sadness2Confused.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi CONFUSED");
					playVideo(selectedCharacter + '/Confused.gif');
				  } else{
					console.log("masih CONFUSED");
					playVideo(selectedCharacter + '/Confused.gif');
				  }
				  break;
				case 'SURPRISED':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi SURPRISED");
					playVideo(selectedCharacter + '/Neutral2Surprised.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi SURPRISED");
					playVideo(selectedCharacter + '/Sadness2Surprised.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi SURPRISED");
					playVideo(selectedCharacter + '/Anger2Surprised.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi SUPRISED");
					playVideo(selectedCharacter + '/Confused2Surprised.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi SURPRISED");
					playVideo(selectedCharacter + '/Anger2Surprised.gif');
				  } else if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi SURPRISED");
					playVideo(selectedCharacter + '/Happy2Surprised.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi SURPRISED");
					playVideo(selectedCharacter + '/Sadness2Surprised.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi SURPRISED");
					playVideo(selectedCharacter + '/Confused2Surprised.gif');
				  } else{
					console.log("masih SURPRISED");
					playVideo(selectedCharacter + '/Surprised.gif');
				  }
				  break;
				case 'CALM':
				  if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi CALM");
					playVideo(selectedCharacter + '/Happy2Neutral.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi CALM");
					playVideo(selectedCharacter + '/Sadness2Neutral.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi CALM");
					playVideo(selectedCharacter + '/Anger2Neutral.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi CALM");
					playVideo(selectedCharacter + '/Confused2Neutral.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi CALM");
					playVideo(selectedCharacter + '/Anger2Neutral.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi CALM");
					playVideo(selectedCharacter + '/Surprised2Neutral.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi CALM");
					playVideo(selectedCharacter + '/Sadness2Neutral.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi CALM");
					playVideo(selectedCharacter + '/Confused2Neutral.gif');
				  } else{
					console.log("masih CALM");
					playVideo(selectedCharacter + '/Neutral.gif');
				  }
				  break;
				case 'DISGUSTED':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi DISGUSTED");
					playVideo(selectedCharacter + '/Neutral2Anger.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi DISGUSTED");
					playVideo(selectedCharacter + '/Sadness2Anger.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi DISGUSTED");
					playVideo(selectedCharacter + '/Anger.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi DISGUSTED");
					playVideo(selectedCharacter + '/Confused2Anger.gif');
				  } else if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi DISGUSTED");
					playVideo(selectedCharacter + '/Happy2Anger.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi DISGUSTED");
					playVideo(selectedCharacter + '/Surprised2Anger.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi DISGUSTED");
					playVideo(selectedCharacter + '/Sadness2Anger.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi DISGUSTED");
					playVideo(selectedCharacter + '/Confused2Anger.gif');
				  } else{
					console.log("masih DISGUSTED");
					playVideo(selectedCharacter + '/Anger.gif');
				  }
				  break;
				case 'FEAR':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi FEAR");
					playVideo(selectedCharacter + '/Neutral2sadness.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi FEAR");
					playVideo(selectedCharacter + '/Sadness.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi FEAR");
					playVideo(selectedCharacter + '/Anger2Sadness.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi FEAR");
					playVideo(selectedCharacter + '/Confused2Sadness.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi FEAR");
					playVideo(selectedCharacter + '/Anger2Sadness.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi FEAR");
					playVideo(selectedCharacter + '/Surprised2Sadness.gif');
				  } else if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi FEAR");
					playVideo(selectedCharacter + '/Happy2Sadness.gif');
				  } else if (prevEmotion == 'UNKNOWN'){
					console.log("dari UNKNOWN jadi FEAR");
					playVideo(selectedCharacter + '/Confused2Sadness.gif');
				  } else{
					console.log("masih FEAR");
					playVideo(selectedCharacter + '/Sadness.gif');
				  }
				  break;
				case 'UNKNOWN':
				  if (prevEmotion == 'CALM'){
					console.log("dari CALM jadi UNKNOWN");
					playVideo(selectedCharacter + '/Neutral2Confused.gif');
				  } else if (prevEmotion == 'SAD'){
					console.log("dari SAD jadi UNKNOWN");
					playVideo(selectedCharacter + '/Sadness2Confused.gif');
				  } else if (prevEmotion == 'ANGRY'){
					console.log("dari ANGRY jadi UNKNOWN");
					playVideo(selectedCharacter + '/Anger2Confused.gif');
				  } else if (prevEmotion == 'CONFUSED'){
					console.log("dari CONFUSED jadi UNKNOWN");
					playVideo(selectedCharacter + '/Confused.gif');
				  } else if (prevEmotion == 'DISGUSTED'){
					console.log("dari DISGUSTED jadi UNKNOWN");
					playVideo(selectedCharacter + '/Anger2Confused.gif');
				  } else if (prevEmotion == 'SURPRISED'){
					console.log("dari SURPRISED jadi UNKNOWN");
					playVideo(selectedCharacter + '/Surprised2Confused.gif');
				  } else if (prevEmotion == 'FEAR'){
					console.log("dari FEAR jadi UNKNOWN");
					playVideo(selectedCharacter + '/Sadness2Confused.gif');
				  } else if (prevEmotion == 'HAPPY'){
					console.log("dari HAPPY jadi UNKNOWN");
					playVideo(selectedCharacter + '/Happy2Confused.gif');
				  } else{
					console.log("masih UNKNOWN");
					playVideo(selectedCharacter + '/Confused.gif');
				  }
				  break;
				  default:
				  console.log("I'm not sure how you're feeling.");
				  playVideo(selectedCharacter + '/Confused.gif');
			  }
			  // Menyimpan emosi saat ini sebagai emosi sebelumnya
			  prevEmotion = emotion;
			}
          }
		  
          fileReader.readAsArrayBuffer(blob);
        }, 'image/jpeg');
      }, 5000); // Setiap 5 detik
	  
    }
  </script>
</body>
</html>
